"$schema" = "https://jj-vcs.github.io/jj/latest/config-schema.json"

[user]
name = "arturasl"
email = "589741+arturasl@users.noreply.github.com"

    # //.files().filter(|f| f.is_conflict() || !f.diff().is_empty())
[ui]
default-command = ["log", "--reversed", "--no-pager", "--template", """
    separate("\n",
        separate(" ",
            change_id.shortest(),
            if(divergent, "ðŸš§"),
            if(hidden, "ðŸ‘»"),
            if(conflict, "ðŸ’¥"),
            if(!description,
               label("empty", "(no description)"),
               if(!immutable,
                  label("description placeholder", description.first_line()))),
            bookmarks.join(", ")
        ),
        if(empty,
           label("empty", "(empty)"),
           if(!immutable,
              diff.files().map(|f| separate(" ",
                if(f.target().conflict(), "ðŸ’¥"),
                f.status(),
                f.path().display(),
                if(f.source().path().display() != f.target().path().display(),
                   label("elided", "<- " ++ f.source().path().display()))
              )).join("\n"))))
"""]

pager = [
    "delta",
    "--line-numbers",
    "--side-by-side",
    "--true-color=always",
    "--hunk-header-style=omit",
]
diff-formatter = ":git"
merge-editor = "diffconflicts"

[aliases]
submit = ["util", "exec", "--", "bash", "-c", """
    set -eu -o pipefail
    rev="${1-@}"
    jj bookmark move --from "heads(::${rev} & bookmarks())" --to "$rev"
    jj git push --remote origin -r "$rev"
    jj
""", ""]

up = ["util", "exec", "--", "bash", "-c", """
    set -eu -o pipefail
    jj git fetch
    jj
""", ""]

[merge-tools.diffconflicts]
program = "nvim"
merge-args = [
    "-c", "let g:jj_diffconflicts_marker_length=$marker_length",
    "-c", "JJDiffConflicts", "$output"
]
merge-tool-edits-conflict-markers = true
